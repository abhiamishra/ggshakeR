<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="ggshakeR">
<title>Guide to Expected Possession Value • ggshakeR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Guide to Expected Possession Value">
<meta property="og:description" content="ggshakeR">
<meta property="og:image" content="https://abhiamishra.github.io/ggshakeR/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-inverse navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">ggshakeR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../index.html">Home</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-guides">Guides</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-guides">
    <a class="dropdown-item" href="../articles/Guide_to_EPV.html">Guide to EPV</a>
    <a class="dropdown-item" href="../articles/Guide_to_Exp_Threat.html">Guide to Expected Threat</a>
    <a class="dropdown-item" href="../articles/Guide_to_Pitch_Plots.html">Guide to Pitch Plots</a>
    <a class="dropdown-item" href="../articles/Guide_to_PizzaPlots.html">Guide to Pizza Plots</a>
    <a class="dropdown-item" href="../articles/Guide_to_Version_0-2-0.html">Guide to Version 0.2.0</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">News</a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://ggshaker.github.io/">Library</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/abhiamishra/ggshakeR/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Guide to Expected Possession Value</h1>
                        <h4 data-toc-skip class="author">Abhishek A.
Mishra</h4>
            
            <h4 data-toc-skip class="date">2022-10-30</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/abhiamishra/ggshakeR/blob/HEAD/vignettes/Guide_to_EPV.Rmd" class="external-link"><code>vignettes/Guide_to_EPV.Rmd</code></a></small>
      <div class="d-none name"><code>Guide_to_EPV.Rmd</code></div>
    </div>

    
    
<p>Welcome to the Expected Possession Value Guide for ggshakeR!</p>
<p>EPV - short for Expected Possession Value - is one of the most
popular and informative metrics out there! Measuring the probability
that an action leads to a goal, EPV allows you to objectively calculate
passes, carries, and other events.</p>
<p>EPV was developed by <a href="https://link.springer.com/article/10.1007/s10994-021-05989-6" class="external-link">Javier
Fernández, Luke Bornn &amp; Daniel Cervone</a>.</p>
<p>There are various iterations of EPV that exist out there. OptaPro has
their own PV while StatsBomb has something similar with their OBV.</p>
<p>The only publicly available data regarding EPV comes from Laurie Shaw
who made an EPV grid public with his work with <a href="https://www.youtube.com/watch?v=KXSLKwADXKI&amp;feature=emb_title" class="external-link">Friends
of Tracking</a></p>
<p>Laurie Shaw’s EPV grid is what ggshakeR uses.</p>
<p>Every time you load in the package, ggshakeR will load in a dataframe
called <strong>EPVGrid</strong>. <strong>EPVGrid</strong> houses all the
EPV data that Laurie Shaw made public and now it is available for you in
a line of code!</p>
<p>Simply write:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/abhiamishra/ggshakeR" class="external-link">ggshakeR</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">EPVGrid</span><span class="op">)</span></span></code></pre></div>
<p>This dataframe is there for you to use and play with. The columns
correspond to pitch divisions from your own goal (V1) to the opponent’s
goal (V50). The grid is symmetrical in half and as such, there is no
“top”/“bottom” of the pitch.</p>
<p>However, what if you want to use EPV? Calculate it?</p>
<p>ggshakeR offers you the <code><a href="../reference/calculate_epv.html">calculate_epv()</a></code> function that
calculates EPV for the data that is passed in!</p>
<p>Here are some characteristics:</p>
<ul>
<li>Needs 4 columns named as <code>x</code>, <code>y</code>,
<code>finalX</code>, <code>finalY</code>.</li>
</ul>
<p>Here’s the cool thing about the <code><a href="../reference/calculate_epv.html">calculate_epv()</a></code>
function: <strong>It calculates the xT of the start of a pass/carry and
the xT of the end of the pass/carry</strong>.</p>
<p>Why is this important? Well, let’s take a take-on. That only has a
starting <code>x</code> ,<code>y</code> . In the dataframe, the columns
of <code>finalX</code> and <code>finalY</code> have <code>NAs</code> in
them. The <code><a href="../reference/calculate_epv.html">calculate_epv()</a></code> will give you the EPV for both
the starting and ending locations allowing you to give a value to
single-event values.</p>
<p>This means, you can use this function beyond passes and carries and
be able to calculate EPV for clearances, tackles, take-ons, etc! In
addition, by separating out the EPV values for the start and end, you
can apply more advanced analytics to the passes.</p>
<p>Let’s see how we can use it!</p>
<div class="section level2">
<h2 id="using-the-calculate_epv-function">Using the <code>calculate_epv()</code> function<a class="anchor" aria-label="anchor" href="#using-the-calculate_epv-function"></a>
</h2>
<p>First, let’s get some data! You can either import you data or use <a href="https://github.com/statsbomb/open-data" class="external-link">Statsbomb’s open free
dataset</a></p>
<p>In this example, I’ll be using StatsBomb’s <a href="https://statsbomb.com/2019/12/messi-data-biography-15-seasons-now-complete-and-available/" class="external-link">Messi
Data</a> for La Liga 2014/15:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">StatsBombR</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Comp</span> <span class="op">&lt;-</span> <span class="fu">FreeCompetitions</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">competition_id</span> <span class="op">==</span> <span class="fl">11</span> <span class="op">&amp;</span> <span class="va">season_name</span> <span class="op">==</span> <span class="st">"2014/2015"</span><span class="op">)</span></span>
<span><span class="va">Matches</span> <span class="op">&lt;-</span> <span class="fu">FreeMatches</span><span class="op">(</span><span class="va">Comp</span><span class="op">)</span></span>
<span><span class="va">StatsBombData</span> <span class="op">&lt;-</span> <span class="fu">free_allevents</span><span class="op">(</span>MatchesDF <span class="op">=</span> <span class="va">Matches</span>, Parallel <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">StatsBombData</span> <span class="op">&lt;-</span> <span class="fu">allclean</span><span class="op">(</span><span class="va">StatsBombData</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plottingData</span> <span class="op">&lt;-</span> <span class="va">StatsBombData</span></span></code></pre></div>
<p>Before plotting, I am going to rename my columns:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plottingData</span> <span class="op">&lt;-</span> <span class="va">plottingData</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">rename</span><span class="op">(</span><span class="st">"x"</span> <span class="op">=</span> <span class="st">"location.x"</span>,</span>
<span>         <span class="st">"y"</span> <span class="op">=</span> <span class="st">"location.y"</span>,</span>
<span>         <span class="st">"finalX"</span> <span class="op">=</span> <span class="st">"pass.end_location.x"</span>,</span>
<span>         <span class="st">"finalY"</span> <span class="op">=</span> <span class="st">"pass.end_location.y"</span><span class="op">)</span></span></code></pre></div>
<p>For <code><a href="../reference/calculate_epv.html">calculate_epv()</a></code>, <strong>always write the
<code>type</code> that the data is: opta or statsbomb</strong>. After
that, we simply get:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">EPVData</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calculate_epv.html">calculate_epv</a></span><span class="op">(</span><span class="va">plottingData</span>, type <span class="op">=</span> <span class="st">"statsbomb"</span><span class="op">)</span></span></code></pre></div>
<p>If we inspect <code>EPVData</code>, we see these two new columns at
the very end:</p>
<div class="figure">
<img src="../reference/figures/calculate_epv.png" style="width:90.0%" alt=""><p class="caption">calculate_epv() producing EPVStart and EPVEnd</p>
</div>
<p>As you’ll see, <code><a href="../reference/calculate_epv.html">calculate_epv()</a></code> will put a -1 in areas
where there was a value that was not right for calculation. To calculate
the difference in EPV, simply write:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">EPVData</span> <span class="op">&lt;-</span> <span class="va">EPVData</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>EPV <span class="op">=</span> <span class="va">EPVEnd</span> <span class="op">-</span> <span class="va">EPVStart</span><span class="op">)</span></span></code></pre></div>
<p>This will give you the difference in EPV and this value can be used
for passes, carries - anything that has a start and an end location. Use
<code>EPVStart</code>/<code>EPVEnd</code> for single-occuring events
such as take-ons, tackles, if you so wish.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Abhishek Amol Mishra, Harsh Krishna, Ryo Nakagawara.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
