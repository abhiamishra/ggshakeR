<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="ggshakeR">
<title>Guide to Expected Threat • ggshakeR</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Guide to Expected Threat">
<meta property="og:description" content="ggshakeR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-inverse navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">ggshakeR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-2">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../index.html">Home</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../articles/index.html">Guides</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/abhiamishra/ggshakeR/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">

<div class="row">
  <main id="main"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Guide to Expected Threat</h1>
                        <h4 data-toc-skip class="author">Abhishek A. Mishra</h4>
            
            <h4 data-toc-skip class="date">2022-01-16</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/abhiamishra/ggshakeR/blob/HEAD/vignettes/Guide_to_Exp_Threat.Rmd" class="external-link"><code>vignettes/Guide_to_Exp_Threat.Rmd</code></a></small>
      <div class="d-none name"><code>Guide_to_Exp_Threat.Rmd</code></div>
    </div>

    
    
<p>Welcome to the Expected Threat Guide for ggshakeR!</p>
<p>First things first, we are only able to do this because of the amazing work by Karun Singh. Read his excellent <a href="https://karun.in/blog/expected-threat.html" class="external-link">xT blog post</a> that goes into in-depth explanation of the need and use of the metric.</p>
<p>Karun Singh’s xT grid is what gghshakeR uses. Every time you load in the package, ggshakeR will load in a dataframe called <strong>xTGrid</strong>. <strong>xTGrid</strong> houses all the xT data that Karun Singh made public and now it is available for you in a line of code!</p>
<p>Simply write:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/abhiamishra/ggshakeR" class="external-link">ggshakeR</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">xTGrid</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="../reference/figures/xTGrid.png" alt="xTGrid dataframe in ggshakeR" style="width:90.0%"><p class="caption">xTGrid dataframe in ggshakeR</p>
</div>
<p>This dataframe is there for you to use and play with. The columns correspond to pitch divisions from your own goal (X0) to the opponent’s goal (X11). The grid is symmetrical in half and as such, there is no “top”/“bottom” of the pitch.</p>
<p>However, what if you want to use xT? Calculate it?</p>
<p>ggshakeR offers you the calculate_threat() function that calculates xT for the data that is passed in!</p>
<p>Here are some characteristics:</p>
<ul>
<li>Needs 4 columns named as <strong>x,y,finalX,finalY</strong>
</li>
</ul>
<p>Here’s the cool thing about the calculate_threat() function: <strong>It calculates the xT of the start of a pass/carry and the xT of the end of the pass/carry</strong>.</p>
<p>Why is this important? Well, let’s take a take-on. That only has a starting x,y. In the dataframe, the columns of finalX and finalY have <code>{r, eval=FALSE} NAs</code> in them. The calculate_threat() will give you the xT for both the starting and ending locations allowing you to give a value to single-event values - basically, it gives you the most freedom and information regarding xT.</p>
<p>Let’s see how we can use it!</p>
<div class="section level2">
<h2 id="using-the-calculate_threat">Using the calculate_threat()<a class="anchor" aria-label="anchor" href="#using-the-calculate_threat"></a>
</h2>
<p>First, let’s get some data! You can either import you data or use <a href="https://github.com/statsbomb/open-data" class="external-link">Statsbomb’s open free dataset</a></p>
<p>In this example, I’ll be using Statsbomb’s Messi Data for LaLiga 2014/15:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Comp</span> <span class="op">&lt;-</span> <span class="fu">FreeCompetitions</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">competition_id</span><span class="op">==</span><span class="fl">11</span> <span class="op">&amp;</span> <span class="va">season_name</span><span class="op">==</span><span class="st">"2014/2015"</span><span class="op">)</span>
<span class="va">Matches</span> <span class="op">&lt;-</span> <span class="fu">FreeMatches</span><span class="op">(</span><span class="va">Comp</span><span class="op">)</span>
<span class="va">StatsBombData</span> <span class="op">&lt;-</span> <span class="fu">StatsBombFreeEvents</span><span class="op">(</span>MatchesDF <span class="op">=</span> <span class="va">Matches</span>, Parallel <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>
<span class="va">StatsBombData</span> <span class="op">=</span> <span class="fu">allclean</span><span class="op">(</span><span class="va">StatsBombData</span><span class="op">)</span>

<span class="va">plottingData</span> <span class="op">=</span> <span class="va">StatsBombData</span></code></pre></div>
<p>Before plotting, I am going to rename my columns:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">plottingData</span> <span class="op">=</span> <span class="va">plottingData</span> <span class="op">%&gt;%</span>
  <span class="fu">rename</span><span class="op">(</span><span class="st">"x"</span><span class="op">=</span><span class="st">"location.x"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">rename</span><span class="op">(</span><span class="st">"y"</span><span class="op">=</span><span class="st">"location.y"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">rename</span><span class="op">(</span><span class="st">"finalX"</span><span class="op">=</span><span class="st">"pass.end_location.x"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">rename</span><span class="op">(</span><span class="st">"finalY"</span><span class="op">=</span><span class="st">"pass.end_location.y"</span><span class="op">)</span></code></pre></div>
<p>For calculate_threat(), <strong>always write the dataType that the data is: opta or statsbomb</strong>. After that, we simply get:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">xTData</span> <span class="op">=</span> <span class="fu"><a href="../reference/calculate_threat.html">calculate_threat</a></span><span class="op">(</span><span class="va">plottingData</span>, dataType<span class="op">=</span><span class="st">"statsbomb"</span><span class="op">)</span></code></pre></div>
<p>If we inspect xTData, we see these two new columns at the very end:</p>
<div class="figure">
<img src="../reference/figures/calculate_threat.png" alt="calculate_threat() producing xTStart and xTEnd" style="width:90.0%"><p class="caption">calculate_threat() producing xTStart and xTEnd</p>
</div>
<p>As you’ll see, calculate_threat() will put a -1 in areas where there was a value that was not right for calculation. To calculate the difference in xT, simply write:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">xTData</span> <span class="op">=</span> <span class="va">xTData</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>xT <span class="op">=</span> <span class="va">xTEnd</span> <span class="op">-</span> <span class="va">xTStart</span><span class="op">)</span></code></pre></div>
<p>This will give you the difference in xT and this value can be used for passes, carries - anything that has a start and an end location. Use xTStart/xTEnd for single-occuring events such as take-ons, tackles, if you so wish.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Abhishek Amol Mishra, Harsh Krishna.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.1.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
